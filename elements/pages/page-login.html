<link rel="import" href="../helper/app-server-behavior.html">

<dom-module id="page-login">
	<template>
		<style>
			:host {
				display: block;
			}

			app-logo-screen {
				padding: 32px;
			}

			#base-footer {
				position: absolute;
				left: 0px;
				right: 0px;
				bottom: 0px;
				padding: 8px;
			}


			#base-footer > .buttons {
				margin-top: 16px;
			}

			paper-input {
				--paper-input-container-color: white;
				--paper-input-container-focus-color: yellow;
				--paper-input-container-invalid-color: orange;
				--paper-input-container-input-color: white;
				width: 100%;
				padding: 0 8px 0 8px;
			}

			paper-button {
				font-weight: 100;
				color: white;
				background-color: rgba(255, 255, 255, 0.2);
				width: 100%;
				text-transform: none;
			}

		</style>

		<app-logo-screen title="{{config.location.tittleLogin}}" logo="images/logo-app.png"></app-logo-screen>

		<div class="horizontal center-justified layout">

		<animation-tag animation="fadeIn">
			<div id="base-footer">

				<app-social-buttons socialbutton="{{socialButton}}"></app-social-buttons>

				<div class="horizontal center-justified layout">
					<paper-input id="email" label="{{config.location.email}}" value="{{user.email}}"></paper-input>
				</div>

				<div class="horizontal center-justified layout">
					<paper-input id="pwd" label="{{config.location.password}}" type="password" value="{{user.password}}"></paper-input>
				</div>

				<div class="horizontal center-justified layout buttons">
					<paper-button on-tap="loginMe">{{config.location.login}}</paper-button>
					<paper-button on-tap="resetPwd">{{config.location.tittleResetPassword}}</paper-button>
				</div>

				<app-footer-buttons page="{{page}}" config="{{config}}"></app-footer-buttons>

			</div>
		</animation-tag>

	</div>

	</template>
</dom-module>

<script>
	Polymer({
		is: 'page-login',
		behaviors: [ appConfig, appServer ],
		properties: {
			auth: {
				type: Boolean,
				notify: true
			},
			user: {
				type:Object,
				value: function(){ return {};},
				notify: true
			},
			userdata: {
				type:Object,
				value: function(){ return {};},
				notify: true,
			},
			page: {
				type: String,
				notify: true
			},
			socialButton: {
				type:String,
				observer: '_socialButton'
			}
		},
		_socialButton: function(data){
			var self = this;
			this.registerFacebook(data,
				function(data, erro){
					if(!erro){
							self.fire('app:message',{message:self.config.location.loginUserCorrect});
							self.userdata = data;
							self._auth();
					}else {
							self.fire('app:alert',{message:self.config.location[erro]});

					};
			});
		},
		_auth: function(){
			this.auth = true;
			this.userdata.auth = true;
			this.page='news';
		},
		loginMe: function () {
			var self = this;
			this.login(this.user,
				function(data, erro){
					if(!erro){
							self.fire('app:message',{message:self.config.location.loginUserCorrect});
							self.userdata = data;
							self._auth();

					}else {
							self.fire('app:alert',{message:self.config.location[erro]});

					};
			});

		},
		resetPwd: function () {
			this.page = 'resetpassword';
		},
		ready: function() {
			this.user = {};
		},

	});
</script>
