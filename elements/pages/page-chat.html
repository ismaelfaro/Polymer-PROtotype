

<dom-module id="page-chat">

  <template>
  <style>
    :host {
      display: block;
    }

    page-new-card{
      margin-bottom: 20px;
    }

  </style>

  <section id="chat">

        <template is="dom-repeat" items="{{items}}" index-as="index">
              <page-new-bubble userID="{{userData.uid}}" item="{{item}}" index="{{index}}"></page-new-bubble>
        </template>

        <paper-input id="menssage" label="{{config.location.message}}" value={{message.message}}></paper-input>

        <paper-button on-tap="_sendMessage" raised>send</paper-button>

      </section>

  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'page-chat',
      behaviors: [appConfig, appServer],
      properties: {
        items: {
          type: Array,
          notify: true,
        },
        userdata: {
          type: Object,
        },
        message: {
          type: Object
        }
      },
      _scrollview: function(){
        this.config.app.scrollChat.scrollTop = this.config.app.scrollChat.scrollHeight+100;
      },
      _sendMessage: function(){
        if(this.message === {}) return;

        this.message.uid = this.userdata.uid;
        this.message.password = this.userdata.password;

        this.send('posts', this.message, function(data){});

        this.message = {};

        this._scrollview();

      },
      _populateData: function(data){
        this.items = data;
      },
      ready: function() {

        var self = this;

        this.message = {};

        this.read('posts',function(data){
            self._populateData(data);
        });
      }
    });
  })();
</script>
