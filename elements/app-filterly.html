<link rel="import" href="../styles/app-theme.html">
<link rel="import" href="layout/app-toolbar.html">

<link rel="import" href="app-config-behavior.html">
<link rel="import" href="helper/app-messagewidget-behavior.html">
<link rel="import" href="helper/app-route-behavior.html">

<dom-module id="app-filterly">

	<link rel="import" type="css" href="app-filterly.css">

	<template>

		<style>
			:host {
				display: block;
				height: 100%;
			}

			iron-pages {
				height: 100%;
			}

			#page {
				background-image: url(../images/background.jpg);
				background-size: cover;
				color: var(--text-primary-color);
				margin: 0px;
				padding: 0px;
			}

			#initcontent, #appcontent {
					display: none;
					height: 100%;
			}

			.show {
					display: block !important;
			}

		</style>

		<section id="initcontent">
			<iron-pages id="page" attr-for-selected="data-route" selected="{{route}}">

				<section  data-route="splash">
					<page-splash  page="{{pageSelector}}"></page-splash>
				</section>

				<section data-route="login">
					<page-login auth="{{authDetect}}" userdata="{{config.userProfile}}" page="{{pageSelector}}"></page-login>
				</section>

				<section data-route="register">
					<page-register page="{{pageSelector}}" auth="{{authDetect}}"></page-register>
				</section>

				<section data-route="resetpassword">
					<page-resetpassword page="{{pageSelector}}"></page-resetpassword>
				</section>

				<section data-route="terms">
					<page-terms page="{{pageSelector}}"></page-terms>
				</section>

			</iron-pages>
		</section>

		<section id="appcontent">
			<paper-drawer-panel id="paperDrawerPanel" right-drawer>
					<div drawer>
						<!-- Drawer Toolbar -->
						<paper-toolbar id="drawerToolbar">
							<span class="paper-font-title">Menu</span>
						</paper-toolbar>

						<!-- Drawer Content -->
						<paper-menu class="list" attr-for-selected="data-route" selected="{{route}}" on-iron-select="onMenuSelect">
							<a data-route="news" href="/#!/news">
								<iron-icon icon="view-list"></iron-icon>
								<span>{{config.location.tittleNews}}</span>
							</a>

							<a data-route="chat" href="/#!/chat">
								<iron-icon icon="dashboard"></iron-icon>
								<span>{{config.location.tittleChat}}</span>
							</a>

							<a data-route="profile" href="/#!/profile">
								<iron-icon icon="face"></iron-icon>
								<span>{{config.location.tittleProfile}}</span>
							</a>

							<a data-route="logout" href="/#!/logout">
								<iron-icon icon="close"></iron-icon>
								<span>{{config.location.tittleLogout}}</span>
							</a>

						</paper-menu>
					</div>
					<paper-header-panel main mode="waterfall">

						<!-- Main Toolbar -->

						<!--  <app-toolbar id="mainToolbar"></app-toolbar>-->

						<paper-toolbar id="mainToolbar">


							<div id="logo" class="paper-font-display2 app-name">

								<iron-image style="background-position-x: 100%;width:50%; height:50%; padding-top: 50px; margin-top: 8px;" sizing="cover" src="{{config.app.logo}}"></iron-image>

							</div>

							<span class="flex"></span>

							<paper-icon-button id="paperToggle" class="menu-button" icon="menu" paper-drawer-toggle> </paper-icon-button>
						</paper-toolbar>

						<!-- Main Content -->
						<div class="content">
							<iron-pages id="pageBase" attr-for-selected="data-route" selected="{{route}}">
								<section data-route="news">
									<page-news></page-news>
								</section>

								<section data-route="chat">
									<animation-tag animation="slideInUp">
										<paper-material elevation="1">
											<h2 class="paper-font-display2">{{config.location.tittleChat}}</h2>
											<!-- <categorie-table></categorie-table> -->

											<page-chat userData='{{config.userProfile}}'></page-chat>
										</paper-material>
									</animation-tag>
								</section>

								<section data-route="profile">
									<animation-tag animation="slideInUp">
										<paper-material elevation="1">
											<h2 class="paper-font-display2">{{config.location.tittleProfile}}</h2>
											<page-profile userData='{{config.userProfile}}' </page-profile>
												<!-- <google-map></google-map> -->
										</paper-material>
									</animation-tag>
								</section>

								<section data-route="logout">
									<animation-tag animation="zoomIn">
										<paper-material elevation="1">
											<h2 class="paper-font-display2">{{config.location.tittleLogout}}</h2>
											<page-logout page="{{pageSelector}}" auth="{{authDetect}}"></page-logout>
										</paper-material>
									</animation-tag>
								</section>

							</iron-pages>
						</div>
					</paper-header-panel>
				</paper-drawer-panel>

		</section>

		<paper-toast id="caching-complete" duration="6000" text="Caching complete! This app will work offline."></paper-toast>

		<platinum-sw-register auto-register clients-claim skip-waiting on-service-worker-installed="displayInstalledToast">
			<platinum-sw-cache default-cache-strategy="networkFirst" precache-file="precache.json"></platinum-sw-cache>
		</platinum-sw-register>

	</template>
</dom-module>

<script>
 Polymer({
		is: 'app-filterly',
		behaviors: [appConfig , appMessageWidget, appRoute],
		properties: {
			authDetect: {
					type: Boolean,
					observer: '_checkAuth'
			}
		},
		_checkAuth: function(){
				this.config.userProfile.auth = this.authDetect;

				if(this.config.userProfile.auth){
					this.config.saveCookie();
					this._showApp();
				}else{
					this._showInit();
				}

		},
		_showInit: function(){

			this.$.appcontent.classList.remove ('show');
			this.$.initcontent.classList.add ('show');

		},
		_showApp: function(){

			this.$.appcontent.classList.add ('show');
			this.$.initcontent.classList.remove ('show');

		},
		onMenuSelect: function () {
			if (this.$.paperDrawerPanel.narrow) {
				this.$.paperDrawerPanel.closeDrawer();
			}
		},
		_openMenu: function () {
			this.$.paperDrawerPanel.openDrawer();
		},

		ready: function () {

			this.initRoute();
			this.initMessageWidget();

			// store scroll dom component
			this.config.app.scrollChat= document.querySelector('#mainContainer');
		}
	});

</script>
